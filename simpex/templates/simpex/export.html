{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Container Tracking Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
</head>
<body class="bg-light">
<div class="container mt-4">
    <h2 class="text-warning">Container Tracking Dashboard</h2>
    <p class="text-muted">Visualizaci칩n y filtrado de datos de contenedores</p>

    <!-- 游댳 Men칰 de filtros -->
    <div class="card p-3 mb-3 shadow-sm">
        <form id="filtrosForm" class="row g-3">
            <div class="col-md-3">
                <label for="paisFiltro" class="form-label">Pa칤s</label>
                <input type="text" id="paisFiltro" class="form-control" placeholder="Buscar pa칤s">
            </div>
            <div class="col-md-3">
                <label for="embarqueFiltro" class="form-label">Embarque</label>
                <input type="text" id="embarqueFiltro" class="form-control" placeholder="Buscar embarque">
            </div>
            <div class="col-md-3">
                <label for="statusFiltro" class="form-label">Status</label>
                <select id="statusFiltro" class="form-select">
                    <option value="">Todos</option>
                    <option value="En tr치nsito">En tr치nsito</option>
                    <option value="Verificado">Verificado</option>
                    <option value="Entregado">Entregado</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="fechaFiltro" class="form-label">Fecha POS (desde)</label>
                <input type="date" id="fechaFiltro" class="form-control">
            </div>
        </form>
    </div>

    <!-- 游댳 Tabla -->
    <table id="contenedoresTable" class="table table-striped">
        <thead>
            <tr>
                <th>Pa칤s</th>
                <th>Embarque</th>
                <th>Expediente</th>
                <th>Tama침o</th>
                <th>Fecha POS</th>
                <th>Fecha Despacho</th>
                <th>Status</th>
                <th>Transporte</th>
                <th>ETA</th>
                <th>DAI</th>
                <th>FTS</th>
            </tr>
        </thead>
        <tbody>
            {% for c in contenedores %}
            <tr>
                <td>{{ c.pais }}</td>
                <td>{{ c.embarque }}</td>
                <td>{{ c.expediente }}</td>
                <td>{{ c.tamano }}</td>
                <td>{{ c.fecha_pos }}</td>
                <td>{{ c.fecha_despacho }}</td>
                <td>{{ c.get_status_display }}</td>
                <td>{{ c.transporte }}</td>
                <td>{{ c.eta }}</td>
                <td>${{ c.dai }}</td>
                <td>${{ c.fts }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
$(document).ready(function () {
    var table = $('#contenedoresTable').DataTable();

    // 游댳 Filtro por Pa칤s
    $('#paisFiltro').on('keyup change', function () {
        table.column(0).search(this.value).draw();
    });

    // 游댳 Filtro por Embarque
    $('#embarqueFiltro').on('keyup change', function () {
        table.column(1).search(this.value).draw();
    });

    // 游댳 Filtro por Status
    $('#statusFiltro').on('change', function () {
        table.column(6).search(this.value).draw();
    });

    // 游댳 Filtro por Fecha POS (>=)
    $('#fechaFiltro').on('change', function () {
        var fecha = this.value;
        table.draw();
    });

    // Custom filtering para la fecha POS
    $.fn.dataTable.ext.search.push(
        function (settings, data, dataIndex) {
            var minDate = $('#fechaFiltro').val();
            var fechaPos = data[4]; // Columna Fecha POS

            if (minDate) {
                return new Date(fechaPos) >= new Date(minDate);
            }
            return true;
        }
    );
});
</script>
</body>
</html>
